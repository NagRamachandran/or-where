{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["const {\n  flow,\n  map,\n  pick,\n  filter,\n  sortBy,\n  groupBy,\n  mapValues,\n} = require('lodash/fp');\n\nexport default class FilterBuilder {\n  constructor() {\n    this.resetQuery();\n  }\n\n  select(keys) {\n    // this.flow.push(map((x) => pick(keys)(x)));\n    this.selectKeys = [...new Set([...this.selectKeys, ...keys])];\n    return this;\n  }\n\n  where(...query) {\n    this.makeAnd();\n    if (typeof query[0] === 'function') {\n      this.query += '(';\n      query[0](this);\n      this.query += ')';\n    } else {\n      if (query.length === 1) {\n        this.query += `(item.${query[0]})`;\n      } else if (query.length === 2) {\n        this.query += `(item.${query[0]} == ${\n          typeof query[1] === 'string' ? '\"' + query[1] + '\"' : query[1]\n        })`;\n      } else if (query.length === 3) {\n        this.query += `(item.${query[0]} ${query[1]} ${\n          typeof query[2] === 'string' ? '\"' + query[2] + '\"' : query[2]\n        })`;\n      }\n    }\n    return this;\n  }\n\n  orWhere(...query) {\n    this.query += ' || ';\n    return this.where(...query);\n  }\n\n  whereIncludes(list, key, value = null) {\n    this.makeAnd();\n    if (value == null) {\n      this.query += `(item.${list} ? item.${list}.includes('${key}') : false)`;\n      return this;\n    }\n    this.query += `(item.${list} ? item.${list}.some(element => element.${key} === '${value}') : false)`;\n    return this;\n  }\n\n  orWhereIncludes(list, key, value = null) {\n    this.query += ' || ';\n    this.whereIncludes(list, key, value);\n    return this;\n  }\n\n  whereContains(key, value) {\n    this.makeAnd();\n    this.query += `(item.${key} ? item.${key}.toLowerCase().includes('${value.toLowerCase()}') : false)`;\n    return this;\n  }\n\n  orWhereContains(key, value) {\n    this.query += ' || ';\n    this.whereContains(key, value);\n    return this;\n  }\n\n  whereIn(key, list) {\n    this.makeAnd();\n    this.query += `(item.${key} ? [\"${list.join(\n      '\", \"',\n    )}\"].includes('' + item.${key}) : false)`;\n    return this;\n  }\n\n  orWhereIn(key, list) {\n    this.query += ' || ';\n    this.whereIn(key, list);\n    return this;\n  }\n\n  makeAnd() {\n    if (this.query.slice(-1).includes(')')) {\n      this.query += ' && ';\n    }\n  }\n\n  sort(keys) {\n    // this.flow.push(sortBy(keys));\n    this.sortKeys = [...new Set([...this.sortKeys, ...keys])];\n    return this;\n  }\n\n  group(keys) {\n    this.groupKeys = [...new Set([...this.groupKeys, ...keys])];\n    return this;\n  }\n\n  #nest = (key) => (array) => {\n    if (!key.length) return array;\n    const first = key[0];\n    const rest = key.slice(1);\n    return mapValues((x) => this.#nest(rest)(x))(groupBy(first)(array));\n  };\n\n  #stripEmpties() {\n    this.query = this.query.replace(/&& \\(\\)/g, '');\n    this.query = this.query.replace(/\\(\\)\\s\\s&&/g, '');\n    this.query = this.query.replace(/\\(\\)\\s&&/g, '');\n  }\n\n  get(data) {\n    this.#stripEmpties();\n    return flow(\n      filter((item) => new Function('item', `'use strict';return ${this.query};`)(item)),\n      map((x) => pick(this.selectKeys)(x)), // this for select\n      sortBy(this.sortKeys), // this for sort\n      this.#nest(this.groupKeys), // this for group\n    )(data);\n  }\n\n  resetQuery() {\n    this.query = '';\n    this.selectKeys = [];\n    this.sortKeys = [];\n    this.groupKeys = [];\n  }\n}\n"],"names":["_require","require","flow","map","pick","filter","sortBy","groupBy","mapValues","FilterBuilder","key","array","length","first","rest","slice","x","_classPrivateFieldLooseBase","_this","_nest","this","resetQuery","select","keys","selectKeys","Set","concat","where","query","call","arguments","makeAnd","orWhere","apply","whereIncludes","list","value","orWhereIncludes","whereContains","toLowerCase","orWhereContains","whereIn","join","orWhereIn","includes","sort","sortKeys","group","groupKeys","get","data","_stripEmpties","item","Function","_this2","_stripEmpties2","replace"],"mappings":"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"}