{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["const {\n  flow,\n  map,\n  pick,\n  filter,\n  sortBy,\n  groupBy,\n  mapValues,\n} = require('lodash/fp');\n\nexport default class FilterBuilder {\n  constructor() {\n    this.resetQuery();\n  }\n\n  select(keys) {\n    // this.flow.push(map((x) => pick(keys)(x)));\n    this.selectKeys = [...new Set([...this.selectKeys, ...keys])];\n    return this;\n  }\n\n  where(...query) {\n    this.makeAnd();\n    if (typeof query[0] === 'function') {\n      this.query += '(';\n      query[0](this);\n      this.query += ')';\n    } else {\n      if (query.length === 1) {\n        this.query += `(item.${query[0]})`;\n      } else if (query.length === 2) {\n        this.query += `(item.${query[0]} == ${\n          typeof query[1] === 'string' ? '\"' + query[1] + '\"' : query[1]\n        })`;\n      } else if (query.length === 3) {\n        this.query += `(item.${query[0]} ${query[1]} ${\n          typeof query[2] === 'string' ? '\"' + query[2] + '\"' : query[2]\n        })`;\n      }\n    }\n    return this;\n  }\n\n  orWhere(...query) {\n    this.query += ' || ';\n    return this.where(...query);\n  }\n\n  whereIncludes(list, key, value = null) {\n    this.makeAnd();\n    if (value == null) {\n      this.query += `(item.${list} ? item.${list}.includes('${key}') : false)`;\n      return this;\n    }\n    this.query += `(item.${list} ? item.${list}.some(element => element.${key} === '${value}') : false)`;\n    return this;\n  }\n\n  orWhereIncludes(list, key, value = null) {\n    this.query += ' || ';\n    this.whereIncludes(list, key, value);\n    return this;\n  }\n\n  whereContains(key, value) {\n    this.makeAnd();\n    this.query += `(item.${key} ? item.${key}.toLowerCase().includes('${value.toLowerCase()}') : false)`;\n    return this;\n  }\n\n  orWhereContains(key, value) {\n    this.query += ' || ';\n    this.whereContains(key, value);\n    return this;\n  }\n\n  whereIn(key, list) {\n    this.makeAnd();\n    this.query += `(item.${key} ? [\"${list.join(\n      '\", \"',\n    )}\"].includes('' + item.${key}) : false)`;\n    return this;\n  }\n\n  orWhereIn(key, list) {\n    this.query += ' || ';\n    this.whereIn(key, list);\n    return this;\n  }\n\n  makeAnd() {\n    if (this.query.slice(-1).includes(')')) {\n      this.query += ' && ';\n    }\n  }\n\n  sort(keys) {\n    // this.flow.push(sortBy(keys));\n    this.sortKeys = [...new Set([...this.sortKeys, ...keys])];\n    return this;\n  }\n\n  group(keys) {\n    this.groupKeys = [...new Set([...this.groupKeys, ...keys])];\n    return this;\n  }\n\n  #nest = (key) => (array) => {\n    if (!key.length) return array;\n    const first = key[0];\n    const rest = key.slice(1);\n    return mapValues((x) => this.#nest(rest)(x))(groupBy(first)(array));\n  };\n\n  #stripEmpties() {\n    this.query = this.query.replace(/&& \\(\\)/g, '');\n    this.query = this.query.replace(/\\(\\)\\s\\s&&/g, '');\n    this.query = this.query.replace(/\\(\\)\\s&&/g, '');\n  }\n\n  get(data) {\n    this.#stripEmpties();\n    const flows = [];\n    if (this.selectKeys.length) {\n      flows.push(map((x) => pick(this.selectKeys)(x)));\n    }\n    if (this.sortKeys.length) {\n      flows.push(sortBy(this.sortKeys));\n    }\n    if (this.groupKeys.length) {\n      flows.push(this.#nest(this.groupKeys));\n    }\n    return flow(\n      filter((item) => new Function('item', `'use strict';return ${this.query};`)(item)),\n      // map((x) => pick(this.selectKeys)(x)), // this for select\n      // sortBy(this.sortKeys), // this for sort\n      // this.#nest(this.groupKeys), // this for group\n      ...flows,\n    )(data);\n  }\n\n  resetQuery() {\n    this.query = '';\n    this.selectKeys = [];\n    this.sortKeys = [];\n    this.groupKeys = [];\n  }\n}\n"],"names":["_require","require","flow","map","pick","filter","sortBy","groupBy","mapValues","FilterBuilder","key","array","length","first","rest","slice","x","_classPrivateFieldLooseBase","_this","_nest","this","resetQuery","select","keys","selectKeys","Set","concat","where","query","call","arguments","makeAnd","orWhere","apply","whereIncludes","list","value","orWhereIncludes","whereContains","toLowerCase","orWhereContains","whereIn","join","orWhereIn","includes","sort","sortKeys","group","groupKeys","get","data","_this2","_stripEmpties","flows","push","item","Function","replace"],"mappings":"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"}