{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const {\n  flow,\n  map,\n  pick,\n  filter,\n  sortBy,\n  groupBy,\n  mapValues,\n} = require('lodash/fp');\n\nexport default class FilterBuilder {\n  constructor() {\n    this.resetQuery();\n  }\n\n  select(keys) {\n    // this.flow.push(map((x) => pick(keys)(x)));\n    this.selectKeys = [...new Set([...this.selectKeys, ...keys])];\n    return this;\n  }\n\n  where(...query) {\n    this.makeAnd();\n    if (typeof query[0] === 'function') {\n      this.query += '(';\n      query[0](this);\n      this.query += ')';\n    } else {\n      if (query.length === 1) {\n        this.query += `(item.${query[0]})`;\n      } else if (query.length === 2) {\n        this.query += `(item.${query[0]} == ${\n          typeof query[1] === 'string' ? '\"' + query[1] + '\"' : query[1]\n        })`;\n      } else if (query.length === 3) {\n        this.query += `(item.${query[0]} ${query[1]} ${\n          typeof query[2] === 'string' ? '\"' + query[2] + '\"' : query[2]\n        })`;\n      }\n    }\n    return this;\n  }\n\n  orWhere(...query) {\n    this.query += ' || ';\n    return this.where(...query);\n  }\n\n  whereIncludes(list, key, value = null) {\n    this.makeAnd();\n    if (value == null) {\n      this.query += `(item.${list} ? item.${list}.includes('${key}') : false)`;\n      return this;\n    }\n    this.query += `(item.${list} ? item.${list}.some(element => element.${key} === '${value}') : false)`;\n    return this;\n  }\n\n  orWhereIncludes(list, key, value = null) {\n    this.query += ' || ';\n    this.whereIncludes(list, key, value);\n    return this;\n  }\n\n  whereContains(key, value) {\n    this.makeAnd();\n    this.query += `(item.${key} ? item.${key}.toLowerCase().includes('${value.toLowerCase()}') : false)`;\n    return this;\n  }\n\n  orWhereContains(key, value) {\n    this.query += ' || ';\n    this.whereContains(key, value);\n    return this;\n  }\n\n  whereIn(key, list) {\n    this.makeAnd();\n    this.query += `(item.${key} ? [\"${list.join(\n      '\", \"',\n    )}\"].includes('' + item.${key}) : false)`;\n    return this;\n  }\n\n  orWhereIn(key, list) {\n    this.query += ' || ';\n    this.whereIn(key, list);\n    return this;\n  }\n\n  makeAnd() {\n    if (this.query.slice(-1).includes(')')) {\n      this.query += ' && ';\n    }\n  }\n\n  sort(keys) {\n    // this.flow.push(sortBy(keys));\n    this.sortKeys = [...new Set([...this.sortKeys, ...keys])];\n    return this;\n  }\n\n  group(keys) {\n    this.groupKeys = [...new Set([...this.groupKeys, ...keys])];\n    return this;\n  }\n\n  #nest = (key) => (array) => {\n    if (!key.length) return array;\n    const first = key[0];\n    const rest = key.slice(1);\n    return mapValues((x) => this.#nest(rest)(x))(groupBy(first)(array));\n  };\n\n  #stripEmpties() {\n    this.query = this.query.replace(/&& \\(\\)/g, '');\n    this.query = this.query.replace(/\\(\\)\\s\\s&&/g, '');\n    this.query = this.query.replace(/\\(\\)\\s&&/g, '');\n  }\n\n  get(data) {\n    this.#stripEmpties();\n    return flow(\n      filter((item) => new Function('item', `'use strict';return ${this.query};`)(item)),\n      map((x) => pick(this.selectKeys)(x)), // this for select\n      sortBy(this.sortKeys), // this for sort\n      this.#nest(this.groupKeys), // this for group\n    )(data);\n  }\n\n  resetQuery() {\n    this.query = '';\n    this.selectKeys = [];\n    this.sortKeys = [];\n    this.groupKeys = [];\n  }\n}\n"],"names":["_require","require","flow","map","pick","filter","sortBy","groupBy","mapValues","FilterBuilder","_stripEmpties2","this","query","replace","key","array","length","first","rest","slice","x","_classPrivateFieldLooseBase","_this","_nest","resetQuery","select","keys","selectKeys","Set","concat","where","call","arguments","makeAnd","orWhere","apply","whereIncludes","list","value","orWhereIncludes","whereContains","toLowerCase","orWhereContains","whereIn","join","orWhereIn","includes","sort","sortKeys","group","groupKeys","get","data","_stripEmpties","item","Function","_this2"],"mappings":"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"}