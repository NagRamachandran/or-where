{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const {\n  flow,\n  map,\n  pick,\n  filter,\n  sortBy,\n  groupBy,\n  mapValues,\n} = require('lodash/fp');\n\nexport default class FilterBuilder {\n  constructor() {\n    this.resetQuery();\n  }\n\n  select(keys) {\n    // this.flow.push(map((x) => pick(keys)(x)));\n    this.selectKeys = [...new Set([...this.selectKeys, ...keys])];\n    return this;\n  }\n\n  where(...query) {\n    this.makeAnd();\n    if (typeof query[0] === 'function') {\n      this.query += '(';\n      query[0](this);\n      this.query += ')';\n    } else {\n      if (query.length === 1) {\n        this.query += `(item.${query[0]})`;\n      } else if (query.length === 2) {\n        this.query += `(item.${query[0]} == ${\n          typeof query[1] === 'string' ? '\"' + query[1] + '\"' : query[1]\n        })`;\n      } else if (query.length === 3) {\n        this.query += `(item.${query[0]} ${query[1]} ${\n          typeof query[2] === 'string' ? '\"' + query[2] + '\"' : query[2]\n        })`;\n      }\n    }\n    return this;\n  }\n\n  orWhere(...query) {\n    this.query += ' || ';\n    return this.where(...query);\n  }\n\n  whereIncludes(list, key, value = null) {\n    this.makeAnd();\n    if (value == null) {\n      this.query += `(item.${list} ? item.${list}.includes('${key}') : false)`;\n      return this;\n    }\n    this.query += `(item.${list} ? item.${list}.some(element => element.${key} === '${value}') : false)`;\n    return this;\n  }\n\n  orWhereIncludes(list, key, value = null) {\n    this.query += ' || ';\n    this.whereIncludes(list, key, value);\n    return this;\n  }\n\n  whereContains(key, value) {\n    this.makeAnd();\n    this.query += `(item.${key} ? item.${key}.toLowerCase().includes('${value.toLowerCase()}') : false)`;\n    return this;\n  }\n\n  orWhereContains(key, value) {\n    this.query += ' || ';\n    this.whereContains(key, value);\n    return this;\n  }\n\n  whereIn(key, list) {\n    this.makeAnd();\n    this.query += `(item.${key} ? [\"${list.join(\n      '\", \"',\n    )}\"].includes('' + item.${key}) : false)`;\n    return this;\n  }\n\n  orWhereIn(key, list) {\n    this.query += ' || ';\n    this.whereIn(key, list);\n    return this;\n  }\n\n  makeAnd() {\n    if (this.query.slice(-1).includes(')')) {\n      this.query += ' && ';\n    }\n  }\n\n  sort(keys) {\n    // this.flow.push(sortBy(keys));\n    this.sortKeys = [...new Set([...this.sortKeys, ...keys])];\n    return this;\n  }\n\n  group(keys) {\n    this.groupKeys = [...new Set([...this.groupKeys, ...keys])];\n    return this;\n  }\n\n  #nest = (key) => (array) => {\n    if (!key.length) return array;\n    const first = key[0];\n    const rest = key.slice(1);\n    return mapValues((x) => this.#nest(rest)(x))(groupBy(first)(array));\n  };\n\n  #stripEmpties() {\n    this.query = this.query.replace(/&& \\(\\)/g, '');\n    this.query = this.query.replace(/\\(\\)\\s\\s&&/g, '');\n    this.query = this.query.replace(/\\(\\)\\s&&/g, '');\n  }\n\n  get(data) {\n    this.#stripEmpties();\n    const flows = [];\n    if (this.selectKeys.length) {\n      flows.push(map((x) => pick(this.selectKeys)(x)));\n    }\n    if (this.sortKeys.length) {\n      flows.push(sortBy(this.sortKeys));\n    }\n    if (this.groupKeys.length) {\n      flows.push(this.#nest(this.groupKeys));\n    }\n    return flow(\n      filter((item) => new Function('item', `'use strict';return ${this.query};`)(item)),\n      // map((x) => pick(this.selectKeys)(x)), // this for select\n      // sortBy(this.sortKeys), // this for sort\n      // this.#nest(this.groupKeys), // this for group\n      ...flows,\n    )(data);\n  }\n\n  resetQuery() {\n    this.query = '';\n    this.selectKeys = [];\n    this.sortKeys = [];\n    this.groupKeys = [];\n  }\n}\n"],"names":["_require","require","flow","map","pick","filter","sortBy","groupBy","mapValues","FilterBuilder","this","query","replace","key","array","length","first","rest","slice","x","_classPrivateFieldLooseBase","_this","_nest","resetQuery","select","keys","selectKeys","Set","concat","where","call","arguments","makeAnd","orWhere","apply","whereIncludes","list","value","orWhereIncludes","whereContains","toLowerCase","orWhereContains","whereIn","join","orWhereIn","includes","sort","sortKeys","group","groupKeys","get","data","_this2","_stripEmpties","flows","push","item","Function"],"mappings":"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"}