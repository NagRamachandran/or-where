var e=0;function t(t){return"__private_"+e+++"_"+t}function s(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}const{flow:r,map:i,pick:h,filter:n,sortBy:u,groupBy:o,mapValues:y}=require("lodash/fp");var l=/*#__PURE__*/t("nest"),c=/*#__PURE__*/t("stripEmpties");class a{constructor(){Object.defineProperty(this,c,{value:p}),Object.defineProperty(this,l,{writable:!0,value:e=>t=>{if(!e.length)return t;const r=e[0],i=e.slice(1);return y(e=>s(this,l)[l](i)(e))(o(r)(t))}}),this.resetQuery()}select(e){return this.selectKeys=[...new Set([...this.selectKeys,...e])],this}where(...e){return this.makeAnd(),"function"==typeof e[0]?(this.query+="(",e[0](this),this.query+=")"):1===e.length?this.query+=`(item.${e[0]})`:2===e.length?this.query+=`(item.${e[0]} == ${"string"==typeof e[1]?'"'+e[1]+'"':e[1]})`:3===e.length&&(this.query+=`(item.${e[0]} ${e[1]} ${"string"==typeof e[2]?'"'+e[2]+'"':e[2]})`),this}orWhere(...e){return this.query+=" || ",this.where(...e)}whereIncludes(e,t,s=null){return this.makeAnd(),null==s?(this.query+=`(item.${e} ? item.${e}.includes('${t}') : false)`,this):(this.query+=`(item.${e} ? item.${e}.some(element => element.${t} === '${s}') : false)`,this)}orWhereIncludes(e,t,s=null){return this.query+=" || ",this.whereIncludes(e,t,s),this}whereContains(e,t){return this.makeAnd(),this.query+=`(item.${e} ? item.${e}.toLowerCase().includes('${t.toLowerCase()}') : false)`,this}orWhereContains(e,t){return this.query+=" || ",this.whereContains(e,t),this}whereIn(e,t){return this.makeAnd(),this.query+=`(item.${e} ? ["${t.join('", "')}"].includes('' + item.${e}) : false)`,this}orWhereIn(e,t){return this.query+=" || ",this.whereIn(e,t),this}makeAnd(){this.query.slice(-1).includes(")")&&(this.query+=" && ")}sort(e){return this.sortKeys=[...new Set([...this.sortKeys,...e])],this}group(e){return this.groupKeys=[...new Set([...this.groupKeys,...e])],this}get(e){s(this,c)[c]();const t=[];return this.selectKeys.length&&t.push(i(e=>h(this.selectKeys)(e))),this.sortKeys.length&&t.push(u(this.sortKeys)),this.groupKeys.length&&t.push(s(this,l)[l](this.groupKeys)),r(n(e=>new Function("item",`'use strict';return ${this.query};`)(e)),...t)(e)}resetQuery(){this.query="",this.selectKeys=[],this.sortKeys=[],this.groupKeys=[]}}function p(){this.query=this.query.replace(/&& \(\)/g,""),this.query=this.query.replace(/\(\)\s\s&&/g,""),this.query=this.query.replace(/\(\)\s&&/g,"")}export{a as default};
//# sourceMappingURL=index.modern.js.map
